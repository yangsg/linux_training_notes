


https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html





ysg@vm01:~$ sudo apt update


:) 安装依赖包(如果没有安装该包，则 Data directory initialization 和后续的 server startup 步骤会失败)
ysg@vm01:~$ apt search libaio
ysg@vm01:~$ sudo apt install libaio1

// https://stackoverflow.com/questions/17005654/error-while-loading-shared-libraries-libncurses-so-5
ysg@vm01:~$ sudo apt install libncurses5


ysg@vm01:~$ sudo mkdir /app
ysg@vm01:~$ sudo useradd -r -s /bin/false mysql
ysg@vm01:~$ sudo mkdir -p /mydata/data
ysg@vm01:~$ sudo chown -R mysql:mysql /mydata/data/


ysg@vm01:~$ cd download/
ysg@vm01:~/download$ tree
	.
	└── mysql-8.0.23-linux-glibc2.12-x86_64.tar.xz


ysg@vm01:~/download$ sudo tar -C /app/  -xvf mysql-8.0.23-linux-glibc2.12-x86_64.tar.xz
ysg@vm01:~/download$ cd /app/
ysg@vm01:/app$ ls
	mysql-8.0.23-linux-glibc2.12-x86_64

ysg@vm01:/app$ sudo ln -s /app/mysql-8.0.23-linux-glibc2.12-x86_64 mysql
ysg@vm01:/app$ cd mysql

ysg@vm01:/app/mysql$ ls -F
	bin/  docs/  include/  lib/  LICENSE  man/  README  share/  support-files/


ysg@vm01:/app/mysql$ sudo chown -R root:mysql /app/mysql/

ysg@vm01:/app/mysql$ sudo vim /etc/profile

		export PATH=$PATH:/app/mysql/bin

ysg@vm01:/app/mysql$ source /etc/profile



// 初始化数据库(即初始化 data directory)
 参考: https://dev.mysql.com/doc/refman/8.0/en/data-directory-initialization.html

  //注: 除了使用 命令类似 `sudo bin/mysqld --initialize --user=mysql --basedir=/app/mysql/  --datadir=/mydata/data` 这样的命令
        来初始化 data 目录，也可以指定 option file 来实现初始化选项的指定.
ysg@vm01:/app/mysql$ sudo vim /etc/my.cnf

	[client]  # 注: [client] group 是 所有的 mysql client 工具都会读取的配置文件
	loose-default-character-set = utf8mb4   # 加 loose- 前缀是为解决 [mysqlbinlog] group 不识别该 选项的 问题

	[mysql]
	default-character-set = utf8mb4

	[mysqlbinlog]
	set_charset=utf8mb4

	[mysqld]
	# 设置 mysql 字符集为 utf8mb4
	character-set-client-handshake = FALSE  # 忽略 client 端的 character set 设置
	character-set-server = utf8mb4    # 设置了 character-set-server 的 同时也应该设置 collation-server
	collation-server = utf8mb4_unicode_ci

	basedir=/app/mysql
	datadir=/mydata/data
	port=3306
	server_id=133
	socket=/tmp/mysql.sock

	skip-name-resolve=ON




ysg@vm01:/app/mysql$ sudo bin/mysqld --defaults-file=/etc/my.cnf --initialize --user=mysql  #注意记录下该命令生成的临时密码
2021-02-07T14:07:16.790369Z 0 [System] [MY-013169] [Server] /app/mysql-8.0.23-linux-glibc2.12-x86_64/bin/mysqld (mysqld 8.0.23) initializing of server in progress as process 25129
2021-02-07T14:07:16.899110Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2021-02-07T14:07:19.567621Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2021-02-07T14:07:21.667113Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: ut:5TnMv5tX3   #<<<<<<<记下临时密码



// 设置开机自启
ysg@vm01:/app/mysql$ sudo cp /app/mysql/support-files/mysql.server  /etc/init.d/mysqld
ysg@vm01:/app/mysql$ sudo chmod a+x /etc/init.d/mysqld

ysg@vm01:/app/mysql$ sudo vim /etc/init.d/mysqld

    basedir=/app/mysql
    datadir=/mydata/data


ysg@vm01:~$ sudo update-rc.d mysqld defaults

ysg@vm01:~$ find /etc/rc*.d  | grep mysqld  # 可以观察到, 默认 2 3 4 5 会被设置为开机自启
	/etc/rc0.d/K01mysqld
	/etc/rc1.d/K01mysqld
	/etc/rc2.d/S01mysqld
	/etc/rc3.d/S01mysqld
	/etc/rc4.d/S01mysqld
	/etc/rc5.d/S01mysqld
	/etc/rc6.d/K01mysqld


ysg@vm01:~$ sudo /etc/init.d/mysqld start  #启动 mysqld 服务
	Starting mysqld (via systemctl): mysqld.service.


ysg@vm01:~$ systemctl status mysqld  #使用命令 `systemctl status mysqld` 查看 mysqld 服务状态
	● mysqld.service - LSB: start and stop MySQL
			 Loaded: loaded (/etc/init.d/mysqld; generated)
			 Active: active (running) since Sun 2021-01-24 12:30:36 UTC; 42s ago
				 Docs: man:systemd-sysv-generator(8)
			Process: 5619 ExecStart=/etc/init.d/mysqld start (code=exited, status=0/SUCCESS)
				Tasks: 39 (limit: 1041)
			 Memory: 339.1M
			 CGroup: /system.slice/mysqld.service
							 ├─5627 /bin/sh /app/mysql/bin/mysqld_safe --datadir=/mydata/data --pid-file=/mydata/data/vm01.pid
							 └─5711 /app/mysql/bin/mysqld --basedir=/app/mysql --datadir=/mydata/data --plugin-dir=/app/mysql/lib/plugin --user=mysql --log-error=vm01.err --pid-file=/mydata/data/vm01.pid

	Jan 24 12:30:34 vm01 systemd[1]: Starting LSB: start and stop MySQL...
	Jan 24 12:30:34 vm01 mysqld[5619]: Starting MySQL
	Jan 24 12:30:34 vm01 mysqld[5619]: .
	Jan 24 12:30:34 vm01 mysqld[5627]: Logging to '/mydata/data/vm01.err'.
	Jan 24 12:30:36 vm01 mysqld[5619]: . *
	Jan 24 12:30:36 vm01 systemd[1]: Started LSB: start and stop MySQL.



ysg@vm01:~$ systemctl cat mysqld.service  #查看一下自动生成的 mysqld.service 的内容
	# /run/systemd/generator.late/mysqld.service
	# Automatically generated by systemd-sysv-generator

	[Unit]
	Documentation=man:systemd-sysv-generator(8)
	SourcePath=/etc/init.d/mysqld
	Description=LSB: start and stop MySQL
	Before=multi-user.target
	Before=multi-user.target
	Before=multi-user.target
	Before=graphical.target
	After=network-online.target
	After=remote-fs.target
	After=ypbind.service
	After=nscd.service
	After=ldap.service
	After=ntpd.service
	After=xntpd.service
	Wants=network-online.target

	[Service]
	Type=forking
	Restart=no
	TimeoutSec=5min
	IgnoreSIGPIPE=no
	KillMode=process
	GuessMainPID=no
	RemainAfterExit=yes
	SuccessExitStatus=5 6
	ExecStart=/etc/init.d/mysqld start
	ExecStop=/etc/init.d/mysqld stop
	ExecReload=/etc/init.d/mysqld reload



ysg@vm01:~$ sudo ss -anptu | grep 3306
	tcp    LISTEN  0       70                       *:33060                 *:*      users:(("mysqld",pid=5711,fd=31))
	tcp    LISTEN  0       151                      *:3306                  *:*      users:(("mysqld",pid=5711,fd=33))



ysg@vm01:/app/mysql$ sudo ./bin/mysql_secure_installation --basedir=/app/mysql/
mysql_secure_installation: [ERROR] unknown variable 'basedir=/app/mysql/'.

Securing the MySQL server deployment.

Enter password for user root:



// https://stackoverflow.com/questions/17005654/error-while-loading-shared-libraries-libncurses-so-5
ysg@vm01:/app/mysql$ sudo apt install libncurses5


	mysql: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory




	mysql> SELECT User, Host, plugin FROM mysql.user;
	+------------------+-----------+-----------------------+
	| User             | Host      | plugin                |
	+------------------+-----------+-----------------------+
	| mysql.infoschema | localhost | caching_sha2_password |
	| mysql.session    | localhost | caching_sha2_password |
	| mysql.sys        | localhost | caching_sha2_password |
	| root             | localhost | caching_sha2_password |
	+------------------+-----------+-----------------------+
	4 rows in set (0.00 sec)

	mysql> SHOW VARIABLES LIKE 'character%';
	+--------------------------+----------------------------------------------------------+
	| Variable_name            | Value                                                    |
	+--------------------------+----------------------------------------------------------+
	| character_set_client     | utf8mb4                                                  |
	| character_set_connection | utf8mb4                                                  |
	| character_set_database   | utf8mb4                                                  |
	| character_set_filesystem | binary                                                   |
	| character_set_results    | utf8mb4                                                  |
	| character_set_server     | utf8mb4                                                  |
	| character_set_system     | utf8                                                     |
	| character_sets_dir       | /app/mysql-8.0.23-linux-glibc2.12-x86_64/share/charsets/ |
	+--------------------------+----------------------------------------------------------+
	8 rows in set (0.03 sec)

	mysql> SHOW VARIABLES LIKE 'collation%';
	+----------------------+--------------------+
	| Variable_name        | Value              |
	+----------------------+--------------------+
	| collation_connection | utf8mb4_0900_ai_ci |
	| collation_database   | utf8mb4_0900_ai_ci |
	| collation_server     | utf8mb4_0900_ai_ci |
	+----------------------+--------------------+
	3 rows in set (0.00 sec)




//TODO:











