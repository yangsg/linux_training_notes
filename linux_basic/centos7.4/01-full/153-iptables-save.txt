
# keyword iptables-save

man iptables-save


作用: iptables-save — dump iptables rules to stdout
作用: ip6tables-save — dump iptables rules to stdout

语法: iptables-save [-M,--modprobe modprobe] [-c] [-t table]
语法: ip6tables-save [-M,--modprobe modprobe] [-c] [-t table]

说明:
     iptables-save and ip6tables-save are used to dump the contents of IP or IPv6 Table in easily parseable format to STDOUT. Use I/O-redirection provided by your shell to write to a
     file.

     -M,--modprobe modprobe_program
            Specify the path to the modprobe program. By default, iptables-save will inspect /proc/sys/kernel/modprobe to determine the executable's path.

     -c, --counters
            include the current values of all packet and byte counters in the output

     -t, --table tablename
            restrict output to only one table. If not specified, output includes all available tables.


[root@basic ~]# iptables -nL --line-numbers    # 查看 filter 表中 所有 chains 的规则
      Chain INPUT (policy DROP)
      num  target     prot opt source               destination
      1    ACCEPT     tcp  --  192.168.175.1        192.168.175.10       tcp dpt:22
      2    ACCEPT     icmp --  192.168.175.1        192.168.175.10       icmptype 8
      3    ACCEPT     icmp --  0.0.0.0/0            192.168.175.10       icmptype 0

      Chain FORWARD (policy DROP)
      num  target     prot opt source               destination

      Chain OUTPUT (policy DROP)
      num  target     prot opt source               destination
      1    ACCEPT     tcp  --  192.168.175.10       192.168.175.1        tcp spt:22
      2    ACCEPT     icmp --  192.168.175.10       192.168.175.1        icmptype 0
      3    ACCEPT     icmp --  192.168.175.10       0.0.0.0/0            icmptype 8

[root@basic ~]# iptables -t nat -nL --line-numbers  # 观察 nat 表中 所有 chains 的规则
      Chain PREROUTING (policy ACCEPT)
      num  target     prot opt source               destination
      1    DNAT       tcp  --  0.0.0.0/0            192.168.10.254       tcp dpt:22222 to:192.168.20.10:22
      2    DNAT       tcp  --  0.0.0.0/0            192.168.10.254       tcp dpt:80 to:192.168.20.10:8080
      3    DNAT       all  --  0.0.0.0/0            1.1.1.2              to:192.168.175.20

      Chain INPUT (policy ACCEPT)
      num  target     prot opt source               destination

      Chain OUTPUT (policy ACCEPT)
      num  target     prot opt source               destination

      Chain POSTROUTING (policy ACCEPT)
      num  target     prot opt source               destination

========================================================================================================================
[root@basic ~]# iptables-save > /etc/iptables-save.rules   # 利用 I/O-redirection 持久化保存 iptables 中的所有 tables 中 所有 chains 的 rules, 以后可用 iptables-restore 命令还原

========================================================================================================================
[root@basic ~]# iptables-save   # 在 stdout 上显示 iptables 的 所有 tables 中所有 chains 中的 rules
      # Generated by iptables-save v1.4.21 on Thu May 30 17:31:59 2019
      *nat
      :PREROUTING ACCEPT [0:0]
      :INPUT ACCEPT [0:0]
      :OUTPUT ACCEPT [0:0]
      :POSTROUTING ACCEPT [0:0]
      -A PREROUTING -d 192.168.10.254/32 -p tcp -m tcp --dport 22222 -j DNAT --to-destination 192.168.20.10:22
      -A PREROUTING -d 192.168.10.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.20.10:8080
      -A PREROUTING -d 1.1.1.2/32 -j DNAT --to-destination 192.168.175.20
      COMMIT
      # Completed on Thu May 30 17:31:59 2019
      # Generated by iptables-save v1.4.21 on Thu May 30 17:31:59 2019
      *mangle
      :PREROUTING ACCEPT [1323:98648]
      :INPUT ACCEPT [1323:98648]
      :FORWARD ACCEPT [0:0]
      :OUTPUT ACCEPT [821:244008]
      :POSTROUTING ACCEPT [821:244008]
      COMMIT
      # Completed on Thu May 30 17:31:59 2019
      # Generated by iptables-save v1.4.21 on Thu May 30 17:31:59 2019
      *raw
      :PREROUTING ACCEPT [1323:98648]
      :OUTPUT ACCEPT [821:244008]
      COMMIT
      # Completed on Thu May 30 17:31:59 2019
      # Generated by iptables-save v1.4.21 on Thu May 30 17:31:59 2019
      *filter
      :INPUT DROP [0:0]
      :FORWARD DROP [0:0]
      :OUTPUT DROP [0:0]
      -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p tcp -m tcp --dport 22 -j ACCEPT
      -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      -A INPUT -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p tcp -m tcp --sport 22 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      COMMIT
      # Completed on Thu May 30 17:31:59 2019
========================================================================================================================
[root@basic ~]# iptables-save -t filter   # 在 stdout 上显示 filter 表中所有的 chains 中的 rules
      # Generated by iptables-save v1.4.21 on Thu May 30 17:36:55 2019
      *filter
      :INPUT DROP [0:0]
      :FORWARD DROP [0:0]
      :OUTPUT DROP [0:0]
      -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p tcp -m tcp --dport 22 -j ACCEPT
      -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      -A INPUT -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p tcp -m tcp --sport 22 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      -A OUTPUT -s 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      COMMIT
      # Completed on Thu May 30 17:36:55 2019
========================================================================================================================
[root@basic ~]# iptables-save -t nat > /tmp/iptables-save-nat-table.rules  # 利用 I/O 重定向持久化保存 nat 表中所有 chains 中的规则
========================================================================================================================
[root@basic ~]# iptables-save -t nat     # 在 stdout 上显示 nat 表中所有的 chains 中的 rules
      # Generated by iptables-save v1.4.21 on Thu May 30 17:39:01 2019
      *nat
      :PREROUTING ACCEPT [0:0]
      :INPUT ACCEPT [0:0]
      :OUTPUT ACCEPT [0:0]
      :POSTROUTING ACCEPT [0:0]
      -A PREROUTING -d 192.168.10.254/32 -p tcp -m tcp --dport 22222 -j DNAT --to-destination 192.168.20.10:22
      -A PREROUTING -d 192.168.10.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.20.10:8080
      -A PREROUTING -d 1.1.1.2/32 -j DNAT --to-destination 192.168.175.20
      COMMIT
      # Completed on Thu May 30 17:39:01 2019
========================================================================================================================
[root@basic ~]# iptables-save -t filter -c  # 在 stdout 上显示 filter 表中所有的 chains 中的 rules, 包括当前 all packet and byte counters 的值
      # Generated by iptables-save v1.4.21 on Thu May 30 17:41:46 2019
      *filter
      :INPUT DROP [0:0]
      :FORWARD DROP [0:0]
      :OUTPUT DROP [0:0]
      [1605:120200] -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p tcp -m tcp --dport 22 -j ACCEPT
      [4:240] -A INPUT -s 192.168.175.1/32 -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      [0:0] -A INPUT -d 192.168.175.10/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      [1032:354384] -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p tcp -m tcp --sport 22 -j ACCEPT
      [4:240] -A OUTPUT -s 192.168.175.10/32 -d 192.168.175.1/32 -p icmp -m icmp --icmp-type 0 -j ACCEPT
      [0:0] -A OUTPUT -s 192.168.175.10/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
      COMMIT
      # Completed on Thu May 30 17:41:46 2019
========================================================================================================================

