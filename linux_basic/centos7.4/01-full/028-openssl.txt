
# keyword openssl

man openssl
man req
man rsa
man 5 x509v3_config
man 5 config
man x509
man version

/etc/pki/tls/openssl.cnf

man update-ca-trust

注: RSA非对称加密算法的 1024 位 key 已经不那么安全了, 所以最好使用 2048 位的
---------------------------------------------------------------------------------------------------

[root@basic ~]# yum -y update openssl

[root@basic ~]# rpm -q openssl
    openssl-1.0.2k-16.el7_6.1.x86_64

---------------------------------------------------------------------------------------------------
示例: 一步到位 快速生成 自签名的证书 (包括生成 私钥)

[root@basic ~]# openssl req -x509 -nodes -days 3650 -sha256 -newkey rsa:2048 -keyout mycert.pem -out mycert.pem

    -x509:   生成自签名的证书 而非 生成证书请求
    -nodes:  不为 private key 设密码
    -days n:   证书的有效天数
    -newkey rsa:2048  生成一个新的 证书请求 和 私钥, rsa:2048 表示 2048 bits 的 rsa 私钥
    -keyout filename  将新生成的 私钥 存放在 filename 对应的文件中
    -out filename     此例 中 指的是 自签名的证书 存放的文件 (因为此例中明确使用了选项 -x509 来生成自签名证书)
    -[digest]         签名 证书请求的 摘要算法, 此例为 -sha256, 用于覆盖默认的对应设置(其实当前 /etc/pki/tls/openssl.cnf 中默认也是 sha256)

  此例中 将 私钥 和 证书 存放在了同一个文件中, 所有 如果将 文件的后缀名 命名为 .crt 或 .key 都不太 合适,
  所以命令为了 .pem , 因为 .pem 文件 可以同时包含 证书 和 私钥.


-----------
示例: 一步到位 快速生成 自签名的证书 (包括生成 私钥), 且 直接通过 选项 -subj 来指定 DN (即 Distinguished Name) 而 无需进入交互模式
[root@basic ~]# openssl req  -x509 -nodes -days 3650 -sha256 \
                 -subj '/C=CN/ST=Chongqing/L=Jiulongpo/CN=xintian.com' \
                 -newkey rsa:2048 -keyout mycert.pem -out mycert.pem


---------------------------------------------------------------------------------------------------
示例: 分步骤 生成 私钥, 证书请求 和 自签名证书文件

     注: 实际还应考虑 为 相关目录 和 生成文件 设置合适的权限

[root@basic ~]# mkdir -p /etc/nginx/ssl/private

// 01: 生成 私钥文件
[root@basic ~]# openssl genrsa 2048 > /etc/nginx/ssl/private/server.key

// 02: 生成 证书请求 文件 (利用 已存在的 私钥文件)
[root@basic ~]# openssl req -new -key /etc/nginx/ssl/private/server.key > /etc/nginx/ssl/server.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN   <======= 国家
State or Province Name (full name) []:Chongqing   <========= 省份
Locality Name (eg, city) [Default City]:Jiulongpo  <======== 城市
Organization Name (eg, company) [Default Company Ltd]:Chongqing XinTian Network Co Ltd  <========= 公司名
Organizational Unit Name (eg, section) []:XinTian   <========= 单位名
Common Name (eg, your name or your server's hostname) []:xintian.com   <============= 域名
Email Address []:admin@163.com  <========== 邮箱地址

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:   <======== 直接回车
An optional company name []: <======== 直接回车

    ------------------------------
    可选操作(检查):
             验证 签名:
                [root@basic ~]# openssl req  -in /etc/nginx/ssl/server.csr -noout -verify -key /etc/nginx/ssl/private/server.key
                verify OK
              检查 证书请求 中的 信息:
                [root@basic ~]# openssl req -in /etc/nginx/ssl/server.csr -noout -text

    ------------------------------

// 03: 生成 自签名 证书
[root@basic ~]# openssl req -x509 -days 3650 -key /etc/nginx/ssl/private/server.key -in /etc/nginx/ssl/server.csr > /etc/nginx/ssl/server.crt

---------------------------------------------------------------------------------------------------
示例: 测试新证书: (本例假设 私钥 和 证书 都存放在 mycert.pem 文件中, 且 basic 主机的 ip 为 192.168.175.10)
[root@basic ~]# openssl s_server -cert mycert.pem -www  # 启动 test 服务, 则默认监听在 4433 端口, 注: 使用选项 -accept port 可以使其监听在 其他指定的 端口(port) 上

[root@basic ~]# netstat -anptu | grep openssl
tcp6       0      0 :::4433                 :::*                    LISTEN      1764/openssl

    然后打开浏览器, 访问 https://192.168.175.10:4433
    则可以看到 各种可用的 ciphers 和 一些 connection 的统计信息

    如下这行命令时是 证书 和 私钥 不再同一文件中的例子:
    [root@basic ~]# openssl s_server -cert /etc/nginx/ssl/server.crt  -key /etc/nginx/ssl/private/server.key  -www -accept 4433

// 提取 远程 证书
[root@basic ~]# echo | openssl s_client -connect 192.168.175.10:4433 2>&1 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'
-----BEGIN CERTIFICATE-----
MIIEITCCAwmgAwIBAgIJAKwaZGMXubRmMA0GCSqGSIb3DQEBCwUAMIGmMQswCQYD
VQQGEwJDTjESMBAGA1UECAwJQ2hvbmdxaW5nMRIwEAYDVQQHDAlKaXVsb25ncG8x
KTAnBgNVBAoMIENob25ncWluZyBYaW5UaWFuIE5ldHdvcmsgQ28gTHRkMRAwDgYD
VQQLDAdYaW5UaWFuMRQwEgYDVQQDDAt4aW50aWFuLmNvbTEcMBoGCSqGSIb3DQEJ
ARYNYWRtaW5AMTYzLmNvbTAeFw0xOTA2MjExMTMzMThaFw0yOTA2MTgxMTMzMTha
MIGmMQswCQYDVQQGEwJDTjESMBAGA1UECAwJQ2hvbmdxaW5nMRIwEAYDVQQHDAlK
aXVsb25ncG8xKTAnBgNVBAoMIENob25ncWluZyBYaW5UaWFuIE5ldHdvcmsgQ28g
THRkMRAwDgYDVQQLDAdYaW5UaWFuMRQwEgYDVQQDDAt4aW50aWFuLmNvbTEcMBoG
CSqGSIb3DQEJARYNYWRtaW5AMTYzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEP
ADCCAQoCggEBANBSOwvHK6LP2Mi831nU3OxANLC/s0E+cduugUxuyCBWgu+xtj3/
kb2JFVTZwd6unt0u64mfAML+m34yHdNQ4DWoXDrxXaFd8BIhsNrp1jXbgcNny3El
i7ccufOvDO1tHXWA2fvTD8LMigrUMwmtcNLN4oay9AjSvxqjvkAjSdZ8qGOB8NJS
Up4aKWr90cjzoQGIvIVepWOqpUluCDX1N1BMZCnL31VRnHhyt+rOWnl1rGc2Vl8A
fMmgLjB2HtyuhDNmdIcpF2koz0+mQ+X6km8KFrOGjIH6nlzIKglOnCnQe1efRdXy
yZ7lGkDm5N83u7fth0MqTtg+8Ni9okWkBOMCAwEAAaNQME4wHQYDVR0OBBYEFCLX
1iO/s4uf4YEYfFRwOF4kYzWEMB8GA1UdIwQYMBaAFCLX1iO/s4uf4YEYfFRwOF4k
YzWEMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAHFqGar8mi3t4riy
qtZAOSSZwzhJT9twtsgb7MQKLAb4Ebh9BSXLSD+ZfoBPsMnjwR0SQVPNaFvjo2s6
yvNYnx2qmfVuyf6+i0DVABQgMZkjXE0hQsRDaunqOJ8/xmSXEHyju+1jnm/y4ALr
CDy28PRNVTpWC8wIC8BlvMl8fNx/fTJlKBZs9YDAHMR+6y4u+LKQ830XGEJbnXyB
titeOn7lE65Eb7gjhQFcHQFcDXr/mUHwdwVEa4+R/zp5jxMe9+XYwi9FMpp2gOZ5
xmoeq0aFu/9iyquFDkuzy/sq2g8bdsVb2oVQmbuRq2ECtSNDqGlHRCd+EwmUaZkA
9cto/Nw=
-----END CERTIFICATE-----

// 检查 证书 有效 期限
[root@basic ~]# echo | openssl s_client -connect 192.168.175.10:4433 2>&1 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | openssl x509 -noout -subject -dates
subject= /C=CN/ST=Chongqing/L=Jiulongpo/O=Chongqing XinTian Network Co Ltd/OU=XinTian/CN=xintian.com/emailAddress=admin@163.com
notBefore=Jun 21 11:33:18 2019 GMT
notAfter=Jun 18 11:33:18 2029 GMT

---------------------------------------------------------------------------------------------------
示例: x509 命令的 作用之一 是 显示 证书 信息, 所以可以用它 来 提取出 某些 证书信息


[root@basic ~]# openssl x509 -text -in mycert.pem     # 显示 证书所有信息

[root@basic ~]# openssl x509 -noout -in mycert.pem -issuer   # 谁办法的证书?
issuer= /C=CN/ST=Chongqing/L=Jiulongpo/CN=xintian.com     <---- 自己给自己颁发的证书

[root@basic ~]# openssl x509 -noout -in mycert.pem -subject  # 颁发给谁的证书?
subject= /C=CN/ST=Chongqing/L=Jiulongpo/CN=xintian.com   <------- 颁发给自己的证书

[root@basic ~]# openssl x509 -noout -in mycert.pem -dates    # 证书的有效期限?
notBefore=Jun 21 10:50:54 2019 GMT
notAfter=Jun 18 10:50:54 2029 GMT

[root@basic ~]# openssl x509 -noout -in mycert.pem -issuer -subject -dates   # 一次性显示 如上提到的 多个信息
issuer= /C=CN/ST=Chongqing/L=Jiulongpo/CN=xintian.com
subject= /C=CN/ST=Chongqing/L=Jiulongpo/CN=xintian.com
notBefore=Jun 21 10:50:54 2019 GMT
notAfter=Jun 18 10:50:54 2029 GMT

[root@basic ~]# openssl x509 -noout -in mycert.pem -hash   # what is its hash value?
e126bc89

[root@basic ~]# openssl x509 -noout -in mycert.pem -fingerprint   # what is its MD5 fingerprint?
SHA1 Fingerprint=70:DC:C7:0D:45:73:08:1D:85:F6:5C:F7:33:E9:73:A6:02:2E:22:AC

---------------------------------------------------------------------------------------------------
示例: 导出 或 导入 PKCS#12 证书 (export or import a PKCS#12 certificate)
    关于 PKCS#12 的网上资料:
        https://baike.baidu.com/item/PKCS%2312/3158673?fr=aladdin
        https://www.ibm.com/support/knowledgecenter/zh/SSMNED_5.0.0/com.ibm.apic.apionprem.doc/task_apionprem_generate_pkcs_certificate.html
        https://baike.baidu.com/item/PKCS/1042350
        https://blog.csdn.net/github_37567324/article/details/79883685


// 创建 私钥 和 自签名证书 (导出 PKCS#12 文件所需要)
[root@basic ~]# openssl req -x509 -sha256 -nodes -days 3650 -newkey rsa:2048 -keyout server.key -out server.crt

// 利用 证书 和 私钥 导出(创建) pkcs12 文件(即 server.pfx 文件)
[root@basic ~]# openssl pkcs12 -export -out server.pfx -in server.crt -inkey server.key -name "xintian Certificate"
Enter Export Password:    <============== 直接回车, 不需要 password
Verifying - Enter Export Password: <============== 直接回车, 不需要 password

// 利用 mycert.pem (该文件同时包含 私钥 和 证书) 导出(创建) 为 pkcs12 文件(没有 passphrase)
[root@basic ~]# openssl pkcs12 -export -out mycert.pfx -in mycert.pem -name "My Certificate"
Enter Export Password: <============== 直接回车, 不需要 password
Verifying - Enter Export Password: <============== 直接回车, 不需要 password


// 利用 pkcs12 文件 导出 创建 pem 文件(同时包含 证书 和 私钥)
[root@basic ~]# openssl pkcs12 -in mycert.pfx -out mycert.pem -nodes
Enter Import Password:  <====== 直接回车
MAC verified OK


---------------------------------------------------------------------------------------------------
示例:
      使用 openssl 校验证书链 (以 淘宝 证书为例)
      参考:  https://blog.51cto.com/ipcpu/1982109
             https://raymii.org/s/articles/OpenSSL_manually_verify_a_certificate_against_a_CRL.html
             https://stackoverflow.com/questions/25482199/verify-a-certificate-chain-using-openssl-verify


// 取得淘宝证书信息
[root@basic ~]# openssl s_client -showcerts -connect www.taobao.com:443

// 分析淘宝的证书信息, 提取相应的证书 (注: 但是根证书需要自己从网上下载)

// 获取根证书 (注: 验证用的证书必须是 pem 格式的)
        https://support.globalsign.com/customer/portal/articles/1426602-globalsign-root-certificates

[root@basic ~]# vim Root-R1.crt     # 这里直接复制保存 根证书信息(GlobalSign Root CA), 其实可以在文件 /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem 中找到
-----BEGIN CERTIFICATE-----
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw
MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i
YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT
aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ
jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp
xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp
1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG
snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ
U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8
9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E
BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B
AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz
yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE
38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP
AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad
DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==
-----END CERTIFICATE-----

// 保存 GlobalSign Organization Validation CA 的证书
[root@basic ~]# vim globalsign.crt
-----BEGIN CERTIFICATE-----
MIIEaTCCA1GgAwIBAgILBAAAAAABRE7wQkcwDQYJKoZIhvcNAQELBQAwVzELMAkG
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw0xNDAyMjAxMDAw
MDBaFw0yNDAyMjAxMDAwMDBaMGYxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i
YWxTaWduIG52LXNhMTwwOgYDVQQDEzNHbG9iYWxTaWduIE9yZ2FuaXphdGlvbiBW
YWxpZGF0aW9uIENBIC0gU0hBMjU2IC0gRzIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQDHDmw/I5N/zHClnSDDDlM/fsBOwphJykfVI+8DNIV0yKMCLkZc
C33JiJ1Pi/D4nGyMVTXbv/Kz6vvjVudKRtkTIso21ZvBqOOWQ5PyDLzm+ebomchj
SHh/VzZpGhkdWtHUfcKc1H/hgBKueuqI6lfYygoKOhJJomIZeg0k9zfrtHOSewUj
mxK1zusp36QUArkBpdSmnENkiN74fv7j9R7l/tyjqORmMdlMJekYuYlZCa7pnRxt
Nw9KHjUgKOKv1CGLAcRFrW4rY6uSa2EKTSDtc7p8zv4WtdufgPDWi2zZCHlKT3hl
2pK8vjX5s8T5J4BO/5ZS5gIg4Qdz6V0rvbLxAgMBAAGjggElMIIBITAOBgNVHQ8B
Af8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUlt5h8b0cFilT
HMDMfTuDAEDmGnwwRwYDVR0gBEAwPjA8BgRVHSAAMDQwMgYIKwYBBQUHAgEWJmh0
dHBzOi8vd3d3Lmdsb2JhbHNpZ24uY29tL3JlcG9zaXRvcnkvMDMGA1UdHwQsMCow
KKAmoCSGImh0dHA6Ly9jcmwuZ2xvYmFsc2lnbi5uZXQvcm9vdC5jcmwwPQYIKwYB
BQUHAQEEMTAvMC0GCCsGAQUFBzABhiFodHRwOi8vb2NzcC5nbG9iYWxzaWduLmNv
bS9yb290cjEwHwYDVR0jBBgwFoAUYHtmGkUNl8qJUC99BM00qP/8/UswDQYJKoZI
hvcNAQELBQADggEBAEYq7l69rgFgNzERhnF0tkZJyBAW/i9iIxerH4f4gu3K3w4s
32R1juUYcqeMOovJrKV3UPfvnqTgoI8UV6MqX+x+bRDmuo2wCId2Dkyy2VG7EQLy
XN0cvfNVlg/UBsD84iOKJHDTu/B5GqdhcIOKrwbFINihY9Bsrk8y1658GEV1BSl3
30JAZGSGvip2CTFvHST0mdCF/vIhCPnG9vHQWe3WVjwIKANnuvD58ZAWR65n5ryA
SOlCdjSXVWkkDoPWoC209fN5ikkodBpBocLTJIg1MGCUF7ThBCIxPTsvFwayuJ2G
K1pp74P1S8SqtCr4fKGxhZSM9AyHDPSsQPhZSZg=
-----END CERTIFICATE-----

[root@basic ~]# echo | openssl s_client -connect www.taobao.com:443 2>&1 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'  > taobao.crt

[root@basic ~]# openssl verify Root-R1.crt   # 验证根证书
Root-R1.crt: OK

[root@basic ~]# openssl verify -CAfile Root-R1.crt globalsign.crt   # 验证 GlobalSign Organization Validation CA 的证书
globalsign.crt: OK

[root@basic ~]# openssl verify -CAfile <(cat Root-R1.crt globalsign.crt) taobao.crt   # 验证淘宝证书
taobao.crt: OK

              // 利用 -CApath directory 选项来 验证淘宝证书
              [root@basic ~]# yum -y install openssl-perl    # 安装包含 c_rehash 命令 的 package
              [root@basic ~]# mkdir dir01
              [root@basic ~]# cp Root-R1.crt globalsign.crt dir01/
              [root@basic ~]# c_rehash ./dir01/  # 扫描并创建 filename 为 hash value 的 文件(其实是对原本证书的符号链接)
              Doing ./dir01/
              [root@basic ~]# tree dir01/
                    dir01/
                    ├── 5ad8a5d6.0 -> Root-R1.crt    <------ 观察, 查看证书文件对应的hash值可用 `openssl x509 -noout -hash -in Root-R1.crt`
                    ├── b85455c4.0 -> globalsign.crt <------ 观察
                    ├── globalsign.crt
                    └── Root-R1.crt

              [root@basic ~]# openssl verify -CApath dir01/ taobao.crt  # 使用选项 -CApath 指定目录 来 验证 taobao.crt
              taobao.crt: OK

              [root@basic ~]# openssl x509 -noout -hash -in Root-R1.crt   # 查看 证书 Root-R1.crt 对应的 hash 值
              5ad8a5d6

---------------------------------------------------------------------------------------------------
OpenSSL 所识别的 certificate authorities, 详细信息见 https://www.madboa.com/geek/openssl/#what-certificate-authorities-does-openssl-recognize

[root@basic ~]# openssl version -d
OPENSSLDIR: "/etc/pki/tls"  <------- system 信任的 证书颁发机构 信息 所在目录

[root@basic ~]# tree /etc/pki/tls/
/etc/pki/tls/
├── cert.pem -> /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem   <----该文件包含了被识别的许多权威认证机构的 证书的集合
├── certs
│   ├── ca-bundle.crt -> /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem
│   ├── ca-bundle.trust.crt -> /etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt
│   ├── localhost.crt
│   ├── make-dummy-cert
│   ├── Makefile
│   └── renew-dummy-cert
├── misc
│   ├── CA
│   ├── c_hash
│   ├── c_info
│   ├── c_issuer
│   └── c_name
├── openssl.cnf
└── private
    └── localhost.key


---------------------------------------------------------------------------------------------------
添加信任证书:

https://stackoverflow.com/questions/37043442/how-to-add-certificate-authority-file-in-centos-7
https://www.happyassassin.net/2015/01/14/trusting-additional-cas-in-fedora-rhel-centos-dont-append-to-etcpkitlscertsca-bundle-crt-or-etcpkitlscert-pem/

https://access.redhat.com/errata/RHEA-2013:1596
https://fedoraproject.org/wiki/Features/SharedSystemCertificates


https://manuals.gfi.com/en/kerio/connect/content/server-configuration/ssl-certificates/adding-trusted-root-certificates-to-the-server-1605.html


How to reset the list of trusted CA certificates in RHEL 6 & RHEL 7
https://access.redhat.com/solutions/1549003


[root@basic ~]# rpm -q ca-certificates
ca-certificates-2017.2.14-71.el7.noarch

/etc/pki/ca-trust/source        <--- 包含一些子目录, 其中存放了 系统特定的认证机构的证书和 信任设置, 且格式为 pem 的文件 (其优先级更高)
/usr/share/pki/ca-trust-source  <--- 包含一些子目录, 其中存放了 系统默认的认证机构的证书和 信任设置, 且格式为 pem 的文件 (其优先级更低)

/etc/pki/ca-trust/extracted  <---- 该目录下存放了 update-ca-trust 或 `ca-certificates extract` 命令从其他 资源目录下的配置文件中 动态提取生成的 配置文件

命令 update-ca-trust 与 命令 `ca-certificates extract` 的作用相同, 只是 update-ca-trust 的警告信息会少一些,
因为其 会在 rpm package 安装时被执行,此时非致命的警告通常是不期望被看到的.
---------------------------------------------------------------------------------------------------

// 查看 openssl 版本
[root@basic ~]# openssl version
OpenSSL 1.0.2k-fips  26 Jan 2017


// 显示 openssl 的 所有 version 信息
[root@basic ~]# openssl version -a    # 获取更详细的信息
OpenSSL 1.0.2k-fips  26 Jan 2017
built on: reproducible build, date unspecified
platform: linux-x86_64
options:  bn(64,64) md2(int) rc4(16x,int) des(idx,cisc,16,int) idea(int) blowfish(idx)
compiler: gcc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -DKRB5_MIT -m64 -DL_ENDIAN -Wall -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic -Wa,--noexecstack -DPURIFY -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DRC4_ASM -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM
OPENSSLDIR: "/etc/pki/tls"
engines:  rdrand dynamic


// 显示 openssl 目录
[root@basic ~]# openssl version -d
OPENSSLDIR: "/etc/pki/tls"

---------------------------------------------------------------------------------------------------

// 显示可用的 命令列表 (非常规的技巧: 这里使用的是一个非法的 help 命令 或 -h 选项, 通过 stderr 显示所有的 有效命令)
[root@basic ~]# openssl help
openssl:Error: 'help' is an invalid command.

Standard commands
asn1parse         ca                ciphers           cms
crl               crl2pkcs7         dgst              dh
dhparam           dsa               dsaparam          ec
ecparam           enc               engine            errstr
gendh             gendsa            genpkey           genrsa
nseq              ocsp              passwd            pkcs12
pkcs7             pkcs8             pkey              pkeyparam
pkeyutl           prime             rand              req
rsa               rsautl            s_client          s_server
s_time            sess_id           smime             speed
spkac             ts                verify            version
x509

Message Digest commands (see the `dgst' command for more details)
md2               md4               md5               rmd160
sha               sha1

Cipher commands (see the `enc' command for more details)
aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb
aes-256-cbc       aes-256-ecb       base64            bf
bf-cbc            bf-cfb            bf-ecb            bf-ofb
camellia-128-cbc  camellia-128-ecb  camellia-192-cbc  camellia-192-ecb
camellia-256-cbc  camellia-256-ecb  cast              cast-cbc
cast5-cbc         cast5-cfb         cast5-ecb         cast5-ofb
des               des-cbc           des-cfb           des-ecb
des-ede           des-ede-cbc       des-ede-cfb       des-ede-ofb
des-ede3          des-ede3-cbc      des-ede3-cfb      des-ede3-ofb
des-ofb           des3              desx              idea
idea-cbc          idea-cfb          idea-ecb          idea-ofb
rc2               rc2-40-cbc        rc2-64-cbc        rc2-cbc
rc2-cfb           rc2-ecb           rc2-ofb           rc4
rc4-40            rc5               rc5-cbc           rc5-cfb
rc5-ecb           rc5-ofb           seed              seed-cbc
seed-cfb          seed-ecb          seed-ofb          zlib

// 类似的技巧(trick):
[root@basic ~]# openssl dgst -h


---------------------------------------------------------------------------------------------------
网上资料：

    https://stackoverflow.com/questions/13732826/convert-pem-to-crt-and-key
    https://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file
    https://crypto.stackexchange.com/questions/43697/what-is-the-difference-between-pem-csr-key-and-crt
    https://www.madboa.com/geek/openssl/
    https://www.shellhacks.com/openssl-find-ssl-key-length-linux-command-line/


    https://www.digicert.com/ssl-certificate-country-codes.htm
    https://stackoverflow.com/questions/8075274/is-it-possible-making-openssl-skipping-the-country-common-name-prompts
    https://security.stackexchange.com/questions/150770/are-certificate-sans-case-sensitive

    私钥相关权限设置:
        https://superuser.com/questions/215504/permissions-on-private-key-in-ssh-folder
        https://stackoverflow.com/questions/9270734/ssh-permissions-are-too-open-error
        https://support.rackspace.com/how-to/logging-in-with-an-ssh-private-key-on-linuxmac/
        https://superuser.com/questions/556493/permissions-for-ssl-key
        https://unix.stackexchange.com/questions/115838/what-is-the-right-file-permission-for-a-pem-file-to-ssh-and-scp

    私钥位置:
        https://serverfault.com/questions/259302/best-location-for-ssl-certificate-and-private-keys-on-ubuntu

    HTTPS 安全最佳实践:
          https://blog.myssl.com/ssl-and-tls-deployment-best-practices/
          https://blog.myssl.com/https-security-best-practices/
          https://blog.myssl.com/https-security-best-practices-2/

    使用 openssl 校验证书链
          https://blog.51cto.com/ipcpu/1982109
          https://raymii.org/s/articles/OpenSSL_manually_verify_a_certificate_against_a_CRL.html
          https://stackoverflow.com/questions/25482199/verify-a-certificate-chain-using-openssl-verify


关于证书类型: AlphaSSL, DomainSSL, OrganizationSSL, ExtendedSSL
    https://www.fodytechnologies.com/ssl-certificates/alphassl/
    https://www.globalsign.com/en/ssl-information-center/types-of-ssl-certificate/


    https://www.sslcertificateshop.com/brands/digicert/
    https://www.fodytechnologies.com/ssl-certificates/overview/
    https://help.aliyun.com/document_detail/28548.html?spm=5176.7968328.1266638.5.35321232zS9vAk
    https://help.aliyun.com/document_detail/28543.html?spm=a2c4g.11186623.6.549.10b4549corXfhy
    https://www.alphassl.com/ssl-certificates/

.pem SSL Creation Instructions
    https://www.digicert.com/ssl-support/pem-ssl-creation.htm

中文:
    https://www.cnblogs.com/hnxxcxg/p/7610582.html
    https://www.cnblogs.com/gordon0918/p/5409286.html
    https://www.cnblogs.com/f-ck-need-u/p/7113610.html?utm_source=itdadao&utm_medium=referral

    DES、AES、RSA等常用加密算法介绍与比较
        https://yq.aliyun.com/articles/156277


